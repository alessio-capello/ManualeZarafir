% ------------------------------------------------------------------
% PREAMBOLO "zarafir-Template" - Formato A4
% ------------------------------------------------------------------
\documentclass[12pt,openright,twoside]{scrbook} % KOMA-Script nativo


% ---- Font: Garamond (testo) + Caslon Antique (titoli) ------------
\usepackage{fontspec}        
\setmainfont{Garamond}

% Font per titoli e intestazioni (Caslon Antique)
\newfontfamily\zarafirtitlefont[
  Path = C:/Users/Alessio/AppData/Local/Microsoft/Windows/Fonts/,
  Extension = .ttf,
  UprightFont = Caslo-an
]{CaslonAntique}

% ---- Margini e spaziatura ---------------------------------------

\usepackage{geometry}
\geometry{a4paper,top=40mm,bottom=40mm,left=40mm,right=40mm} % ,bindingoffset=10mm
\usepackage{setspace}
\onehalfspacing

% ------------------------------------------------------------------
% CAPITOLI in stile “CAPITOLO …” con numero gigante
% ------------------------------------------------------------------
\usepackage{titlesec}

% grandezza del numero (puoi cambiarla: 90→100 pt …)
\newcommand{\chapnumfont}{\zarafirtitlefont\fontsize{90}{100}\selectfont}

% formato visuale del titolo di capitolo
\titleformat{\chapter}[display]%
  {\raggedleft}               % tutto il blocco allineato a destra
  {%
    \zarafirtitlefont\scshape\fontsize{32}{36}\selectfont % parola "CAPITOLO" ingrandita
    \MakeUppercase{Capitolo} \\[-1.2\baselineskip] % meno spazio sopra il numero
    \chapnumfont\thechapter   % numero gigante
  }%
  {0pt}                       % spazio orizz. tra etichetta e titolo (non serve)
  {\vspace{1cm}\raggedright\huge\bfseries} % spaziatura regolata
  [\vspace{0.5cm}\rule{\textwidth}{0.4pt}\vspace{1cm}] % linea e spazio sotto

% spazi prima / dopo
\titlespacing*{\chapter}{0pt}{0pt}{20pt}

% ---- Sezioni e sottosezioni ---------------------------------------
\setkomafont{section}{\zarafirtitlefont\LARGE\bfseries}      % Sezioni grandi
\setkomafont{subsection}{\zarafirtitlefont\Large\bfseries}   % Sottosezioni medie
\setkomafont{subsubsection}{\zarafirtitlefont\normalsize\bfseries} % Sotto-sotto piccole

% ---- Spaziatura delle sezioni -------------------------------------
\RedeclareSectionCommand[
  beforeskip=15pt,  % spazio prima della sezione
  afterskip=10pt    % spazio dopo la sezione
]{section}

\RedeclareSectionCommand[
  beforeskip=12pt,
  afterskip=8pt
]{subsection}

\RedeclareSectionCommand[
  beforeskip=10pt,
  afterskip=6pt
]{subsubsection}

% ---- Stile Sommario (Indice) con KOMA-Script --------------------
\KOMAoptions{toc=graduated}  % Stile del sommario migliorato
\renewcommand{\contentsname}{Indice}  % Cambia il titolo in italiano

% Stile del titolo "Indice"
\makeatletter
\renewcommand{\tableofcontents}{%
  \chapter*{\centering \Huge\bfseries\rmfamily Indice} % Titolo centrato e grande
  \addcontentsline{toc}{chapter}{Indice} % Aggiungi al sommario
  \vspace{0.5cm}
  \hrule
  \vspace{0.5cm}
  \@starttoc{toc}
}
\makeatother

% ---- Stile Sommario (Indice) con KOMA-Script --------------------
\KOMAoptions{toc=graduated}  % Stile del sommario migliorato
\renewcommand{\contentsname}{Indice}  % Cambia il titolo in italiano

% Font Garamond per tutto il sommario
\setkomafont{chapterentry}{\rmfamily\Large}                % Capitoli in Garamond, grande
\setkomafont{section}{\rmfamily\Large}               % Sezioni in Garamond, normali
\setkomafont{subsection}{\rmfamily\normalsize}       % Sottosezioni in Garamond
\setkomafont{subsubsection}{\rmfamily\small}         % Sotto-sottosezioni in Garamond
\setkomafont{pagenumber}{\rmfamily}                  % Numeri di pagina in Garamond

% Nessun effetto speciale, nessuna linea tratteggiata


% Stile del titolo "Indice"
\makeatletter
\renewcommand{\tableofcontents}{%
  \chapter*{\centering \Huge\rmfamily Indice} % Titolo centrato e grande in Garamond
  \addcontentsline{toc}{chapter}{Indice} % Aggiungi al sommario
  \vspace{0.5cm}
  \@starttoc{toc}
}
\makeatother

% ---- Intestazioni e piè di pagina (KOMA) -------------------------
\usepackage{scrlayer-scrpage}
\clearpairofpagestyles

% Definizione del font Garamond
\newfontfamily\garamondfont{Garamond}

% Numero di pagina centrato in basso in Garamond
\cfoot{\garamondfont\thepage} % Numeri di pagina in basso centrati in Garamond

% Intestazioni delle pagine: titolo capitolo in alto in Garamond
\ihead[\garamondfont\leftmark]{\garamondfont\leftmark} % Titolo capitolo in Garamond
\ohead{}

% Aggiorna l'automark solo per i capitoli (evita conflitti)
\automark[chapter]{chapter}

% ---- Stile pagina senza intestazione (solo per la prima pagina del capitolo) ----
\newcommand{\noheadfirstpage}{%
  \thispagestyle{plain} % Usa lo stile "plain" senza intestazione
  \renewcommand{\headmark}{} % Rimuove l'intestazione (head)
}



% ---- Ipertesto & PDF metadata ------------------------------------
\usepackage{hyperref}
\hypersetup{
  colorlinks=true,
  linkcolor=black,
  urlcolor=blue,
  pdftitle={Zarafir Manuale},
  pdfauthor={Il Tuo Nome}
}


% ---- Itemize Eleganti per GDR (3 Livelli) --------------------
\usepackage{enumitem}  % Per personalizzare itemize

% Primo livello (Diamond - ♦)
\setlist[itemize,1]{%
  label={\textcolor{black}{♦}},    % Simbolo diamante (♦)
  labelsep=0.75em,                 % Spazio tra punto e testo
  left=1.5em,                      % Rientro per il primo livello
  font=\rmfamily,                  % Garamond per il testo
  itemsep=0.4em,                   % Spazio verticale tra voci
  topsep=0.5em                     % Spazio prima della lista
}

% Secondo livello (Circle - ●)
\setlist[itemize,2]{%
  label={\textcolor{black}{\textbullet}}, % Cerchio pieno (●)
  labelsep=0.75em,                       % Spazio tra punto e testo
  left=1.75em,                            % Rientro per il secondo livello
  font=\rmfamily,                        % Garamond per il testo
  itemsep=0.3em                          % Spazio verticale tra voci
}

% Terzo livello (Period - ·)
\setlist[itemize,3]{%
  label={\textcolor{black}{\textperiodcentered}}, % Punto centrato (·)
  labelsep=0.75em,                               % Spazio tra punto e testo
  left=0.5em,                                    % Rientro per il terzo livello
  font=\rmfamily,                                % Garamond per il testo
  itemsep=0.2em                                  % Spazio verticale tra voci
}



% ---- Per capitoli in subfile -------------------------------------
\usepackage{subfiles}


% ---- Import immagini -------------------------------------
\usepackage{graphicx}
\graphicspath{ {./images/} }


% ------------------------------------------------------------------
% INIZIO DOCUMENTO
% ------------------------------------------------------------------

\title{Zarafir}
\author{}
\date{} 

\begin{document}
\frontmatter
\begin{titlepage}
  \centering
  \includegraphics[width=\textwidth]{upscaled_logo}
  \includegraphics[width=\textwidth]{upscaled_text}
  {\Huge\bfseries\zarafirtitlefont  Manuale di Gioco di Ruolo\vspace{1cm}\par}
  %{\Large Vodars\par}
  \vfill
  {\large Versione \today\par}
\end{titlepage}

\tableofcontents                    
\cleardoublepage
\mainmatter               

%------------TEST


%----------FINE TEST

% ---- Capitoli separati -------------------------------------------
\chapter{Introduzione}
\noheadfirstpage
\subfile{sections/introduzione}
\clearpage

\chapter{Obiettivo del Manuale}
\noheadfirstpage
\subfile{sections/ambientazione}
\clearpage

\chapter{Creazione Personaggio}
\noheadfirstpage
\subfile{sections/creazione_pg}
\clearpage

\chapter{Bussola Morale}
\noheadfirstpage
\subfile{sections/bussola_morale}
\clearpage

\chapter{Punti Vita, Stress Mentale, Esperienza}
\noheadfirstpage
\subfile{sections/vita_mana}
\clearpage

\chapter{Conoscenze}
\noheadfirstpage
\subfile{sections/conoscenze}
\clearpage

\chapter{Tiro di Simulazione}
\noheadfirstpage
\subfile{sections/TDS}
\clearpage

\chapter{Abilità}
\noheadfirstpage
\subfile{sections/abilita}
\clearpage

\chapter{Talenti}
\noheadfirstpage
\subfile{sections/talenti}
\clearpage




\end{document}
